<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>直式時間加減小學堂</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
            touch-action: manipulation;
            background-color: #ecfdf5;
            /* Emerald-50 */
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .animate-shake {
            animation: shake 0.3s cubic-bezier(.36, .07, .19, .97) both;
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            80% {
                transform: scale(1.1);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animate-pop-in {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-40px);
                opacity: 0;
            }
        }

        .animate-float-up {
            animation: floatUp 1.0s ease-out forwards;
        }

        @keyframes drawArrow {
            from {
                stroke-dashoffset: 300;
                opacity: 0;
            }

            to {
                stroke-dashoffset: 0;
                opacity: 1;
            }
        }

        .animate-draw-arrow {
            stroke-dasharray: 300;
            animation: drawArrow 0.6s ease-out forwards;
        }

        /* Strike-through animation */
        .strike-through {
            position: relative;
            display: inline-block;
            color: #94a3b8;
            /* slate-400 */
        }

        .strike-through::after {
            content: '';
            position: absolute;
            left: -10%;
            top: 50%;
            width: 120%;
            height: 2px;
            background-color: #ef4444;
            transform: rotate(-15deg);
            transform-origin: center;
            opacity: 0.8;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .unit-box {
            font-variant-numeric: tabular-nums;
        }

        /* Error Bubble Arrow */
        .bubble-arrow {
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #fee2e2;
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Fixed Dimensions for Precise SVG Alignment - Compact Version */
        .col-width {
            width: 100px;
        }

        .gap-width {
            width: 24px;
        }

        .op-width {
            width: 32px;
        }
    </style>
</head>

<body class="text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, useMemo } = React;

        // --- Icons ---
        const Clock = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></svg>;
        const Trophy = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></svg>;
        const RefreshCw = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></svg>;
        const ArrowRight = ({ className, size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size || "24"} height={size || "24"} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14" /><path d="m12 5 7 7-7 7" /></svg>;
        const ArrowLeft = ({ className, size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size || "24"} height={size || "24"} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 19-7-7 7-7" /><path d="M19 12H5" /></svg>;
        const Flame = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" /></svg>;
        const HandPointer = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0" /><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2" /><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8" /><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15" /></svg>;
        const BookOpen = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></svg>;
        const Keyboard = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="16" x="2" y="4" rx="2" ry="2" /><path d="M6 8h.001" /><path d="M10 8h.001" /><path d="M14 8h.001" /><path d="M18 8h.001" /><path d="M6 12h.001" /><path d="M10 12h.001" /><path d="M14 12h.001" /><path d="M18 12h.001" /><path d="M6 16h.001" /><path d="M10 16h.001" /><path d="M14 16h.001" /><path d="M18 16h.001" /></svg>;
        const Scissors = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="6" cy="6" r="3" /><circle cx="6" cy="18" r="3" /><line x1="20" y1="4" x2="8.12" y2="15.88" /><line x1="14.47" y1="14.48" x2="20" y2="20" /><line x1="8.12" y1="8.12" x2="12" y2="12" /></svg>;
        const Lightbulb = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5a6 6 0 0 0-11 0c0 1.5.5 2.5 1.5 3.5.8.8 1.3 1.5 1.5 2.5" /><path d="M9 18h6" /><path d="M10 22h4" /></svg>;
        const Move = ({ className, size }) => <svg xmlns="http://www.w3.org/2000/svg" width={size || "24"} height={size || "24"} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 9l-3 3 3 3M9 5l3-3 3 3M19 9l3 3-3 3M9 19l3 3 3-3M2 12h20M12 2v20" /></svg>;

        // --- Configuration ---
        const LEVELS = [
            { level: 1, type: 'add', label: '時間加法', desc: '分與秒 (不進位)', units: ['分', '秒'], bases: [0, 60], maxVals: [59, 59] },
            { level: 2, type: 'add', label: '時間加法', desc: '分與秒 (需進位)', units: ['分', '秒'], bases: [0, 60], maxVals: [59, 59], forceCarry: true },
            { level: 3, type: 'add', label: '時間加法', desc: '時、分、秒 (連續進位)', units: ['時', '分', '秒'], bases: [0, 60, 60], maxVals: [12, 59, 59], forceCarry: true },
            { level: 4, type: 'sub', label: '時間減法', desc: '分與秒 (需借位)', units: ['分', '秒'], bases: [0, 60], maxVals: [59, 59], forceBorrow: true },
            { level: 5, type: 'sub', label: '時間減法', desc: '時與分 (需借位)', units: ['時', '分'], bases: [0, 60], maxVals: [23, 59], forceBorrow: true },
            { level: 6, type: 'add', label: '時間加法', desc: '日與時 (需進位)', units: ['日', '時'], bases: [0, 24], maxVals: [10, 23], forceCarry: true },
            { level: 7, type: 'add', label: '時間加法', desc: '日、時、分 (連續進位)', units: ['日', '時', '分'], bases: [0, 24, 60], maxVals: [5, 23, 59], forceCarry: true },
            { level: 8, type: 'sub', label: '時間減法', desc: '日與時 (需借位)', units: ['日', '時'], bases: [0, 24], maxVals: [10, 23], forceBorrow: true },
            { level: 9, type: 'sub', label: '時間減法', desc: '日、時、分 (連續借位)', units: ['日', '時', '分'], bases: [0, 24, 60], maxVals: [5, 23, 59], forceBorrow: true },
            { level: 10, type: 'mixed', label: '綜合挑戰', desc: '時間加減混合大挑戰', units: [], bases: [], maxVals: [], forceBorrow: true, forceCarry: true },
        ];

        // --- Helper Functions ---
        const generateProblem = (config) => {
            const numUnits = config.units.length;
            let top = [], bottom = [], expected = [];
            let isValid = false;
            let attempts = 0;

            while (!isValid && attempts < 1000) {
                attempts++;
                top = []; bottom = []; expected = [];
                let carry = 0;
                let validProblem = true;

                if (config.type === 'add') {
                    // Addition Logic
                    for (let i = numUnits - 1; i >= 0; i--) {
                        const base = config.bases[i];
                        const max = config.maxVals[i];

                        let t, b;

                        if (config.forceCarry && base > 0) {
                            const minSum = base;
                            const maxSum = base + max - 1;
                            const targetSum = Math.floor(Math.random() * (maxSum - minSum + 1)) + minSum;
                            t = Math.floor(Math.random() * (targetSum + 1));
                            b = targetSum - t;

                            if (t > max) { t = max; b = targetSum - t; }
                            if (b > max) { b = max; t = targetSum - b; }
                            if (b < 0) { validProblem = false; }
                        } else {
                            t = Math.floor(Math.random() * (max / 2 + 1));
                            b = Math.floor(Math.random() * (max / 2 + 1));
                        }

                        top[i] = t;
                        bottom[i] = b;
                    }

                    for (let i = numUnits - 1; i >= 0; i--) {
                        let sum = top[i] + bottom[i] + carry;
                        const base = config.bases[i];
                        if (base > 0 && sum >= base) {
                            expected[i] = sum % base;
                            carry = Math.floor(sum / base);
                        } else {
                            expected[i] = sum;
                            carry = 0;
                        }
                    }

                    isValid = validProblem;

                } else {
                    // Subtraction Logic
                    config.type = 'sub';

                    for (let i = 0; i < numUnits; i++) {
                        top[i] = Math.floor(Math.random() * (config.maxVals[i] + 1));
                        if (i === 0 && top[i] < 2) top[i] = Math.floor(Math.random() * 5) + 3;
                    }

                    if (config.forceBorrow && numUnits === 3 && Math.random() > 0.4) {
                        top[1] = 0;
                    }

                    for (let i = 0; i < numUnits; i++) {
                        let b;

                        if (config.forceBorrow && i > 0) {
                            const maxVal = config.maxVals[i];
                            if (top[i] < maxVal) {
                                const minBottom = top[i] + 1;
                                b = Math.floor(Math.random() * (maxVal - minBottom + 1)) + minBottom;
                            } else {
                                b = Math.floor(Math.random() * top[i]);
                            }
                        } else {
                            b = Math.floor(Math.random() * (top[i] + 1));
                        }

                        bottom[i] = b;
                    }

                    let currentBorrow = 0;
                    for (let i = numUnits - 1; i >= 0; i--) {
                        let t = top[i];
                        let b = bottom[i];
                        let val = t - b - currentBorrow;
                        const base = config.bases[i];

                        if (val < 0) {
                            if (i === 0) {
                                validProblem = false;
                                break;
                            }
                            val += base;
                            currentBorrow = 1;
                        } else {
                            currentBorrow = 0;
                        }
                        expected[i] = val;
                    }

                    if (config.forceBorrow) {
                        let didBorrow = false;
                        let tempBorrow = 0;
                        for (let i = numUnits - 1; i >= 0; i--) {
                            if (top[i] - bottom[i] - tempBorrow < 0) {
                                didBorrow = true;
                                tempBorrow = 1;
                            } else {
                                tempBorrow = 0;
                            }
                        }
                        if (!didBorrow) validProblem = false;
                    }

                    isValid = validProblem;
                }
            }

            if (!isValid) {
                return { top: config.type === 'add' ? [0, 30] : [1, 10], bottom: config.type === 'add' ? [0, 30] : [0, 5], expected: config.type === 'add' ? [1, 0] : [1, 5] };
            }

            return { top, bottom, expected, type: config.type, units: config.units, bases: config.bases };
        };

        // --- Main Component ---
        function TimeMathApp() {
            const [level, setLevel] = useState(1);
            const [problem, setProblem] = useState(null);

            const [userInputs, setUserInputs] = useState({});
            const [currentUnitIndex, setCurrentUnitIndex] = useState(null);

            const [borrowState, setBorrowState] = useState({});
            const [isBorrowingMode, setIsBorrowingMode] = useState(false);
            const [borrowTarget, setBorrowTarget] = useState(null);

            const [carryState, setCarryState] = useState({});
            const [waitingForCarry, setWaitingForCarry] = useState(null);

            const [feedback, setFeedback] = useState({ type: 'info', msg: '準備好了嗎？從最右邊開始計算！' });
            const [shake, setShake] = useState(false);
            const [errorUnit, setErrorUnit] = useState(null);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);
            const [showCertificate, setShowCertificate] = useState(false);
            const [floatAnims, setFloatAnims] = useState([]);
            const [arrowAnim, setArrowAnim] = useState(null);

            const nextButtonRef = useRef(null);

            // -- Generic Drag State --
            const [elementOffsets, setElementOffsets] = useState({}); // { [key: string]: {x, y} }
            const [activeDragId, setActiveDragId] = useState(null);
            const dragInfoRef = useRef(null);

            // -- Updated Drag Handlers (Using useCallback instead of complex ref wrapper) --
            const handleGlobalMove = useCallback((e) => {
                if (!dragInfoRef.current) return;
                e.preventDefault();

                const { id, startX, startY, initX, initY } = dragInfoRef.current;

                let clientX, clientY;
                if (e.type.startsWith('touch')) {
                    if (e.touches && e.touches.length > 0) {
                        clientX = e.touches[0].clientX;
                        clientY = e.touches[0].clientY;
                    } else {
                        return;
                    }
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }

                if (clientX === undefined || clientY === undefined) return;

                const deltaX = clientX - startX;
                const deltaY = clientY - startY;

                const newX = Math.max(-100, Math.min(100, initX + deltaX));
                const newY = Math.max(-100, Math.min(100, initY + deltaY));

                setElementOffsets(prev => ({
                    ...prev,
                    [id]: { x: newX, y: newY }
                }));
            }, []);

            const handleGlobalEnd = useCallback(() => {
                dragInfoRef.current = null;
                setActiveDragId(null);

                document.removeEventListener('mousemove', handleGlobalMove);
                document.removeEventListener('mouseup', handleGlobalEnd);
                document.removeEventListener('touchmove', handleGlobalMove);
                document.removeEventListener('touchend', handleGlobalEnd);
                document.removeEventListener('touchcancel', handleGlobalEnd);
            }, [handleGlobalMove]);

            const startDrag = (e, id) => {
                // Prevent default behavior to stop text selection etc.
                if (e.type === 'mousedown') e.preventDefault();
                e.stopPropagation();

                let clientX, clientY;
                if (e.type.startsWith('touch')) {
                    if (e.touches && e.touches.length > 0) {
                        clientX = e.touches[0].clientX;
                        clientY = e.touches[0].clientY;
                    } else return;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }

                const current = elementOffsets[id] || { x: 0, y: 0 };
                dragInfoRef.current = { id, startX: clientX, startY: clientY, initX: current.x, initY: current.y };
                setActiveDragId(id);

                if (e.type.startsWith('touch')) {
                    document.addEventListener('touchmove', handleGlobalMove, { passive: false });
                    document.addEventListener('touchend', handleGlobalEnd);
                    document.addEventListener('touchcancel', handleGlobalEnd);
                } else {
                    document.addEventListener('mousemove', handleGlobalMove);
                    document.addEventListener('mouseup', handleGlobalEnd);
                }
            };

            // Cleanup on unmount
            useEffect(() => {
                return () => {
                    document.removeEventListener('mousemove', handleGlobalMove);
                    document.removeEventListener('mouseup', handleGlobalEnd);
                    document.removeEventListener('touchmove', handleGlobalMove);
                    document.removeEventListener('touchend', handleGlobalEnd);
                    document.removeEventListener('touchcancel', handleGlobalEnd);
                };
            }, [handleGlobalMove, handleGlobalEnd]);

            const getEffectiveValue = (idx, currentTop, currentBorrowState) => {
                let val = currentTop[idx];
                if (currentBorrowState[idx]?.borrowedFrom) val -= 1;
                if (currentBorrowState[idx]?.receivedBorrow) val += currentBorrowState[idx].addedVal;
                return val;
            };

            const startLevel = useCallback((lvl) => {
                let config = LEVELS.find(l => l.level === lvl);

                if (lvl === 10) {
                    const isAdd = Math.random() > 0.5;
                    const useDayHourMin = Math.random() > 0.5;
                    const useThreeUnits = Math.random() > 0.5;

                    let units, bases, maxVals;

                    if (useDayHourMin) {
                        if (useThreeUnits) {
                            units = ['日', '時', '分'];
                            bases = [0, 24, 60];
                            maxVals = [5, 23, 59];
                        } else {
                            units = ['日', '時'];
                            bases = [0, 24];
                            maxVals = [10, 23];
                        }
                    } else {
                        if (useThreeUnits) {
                            units = ['時', '分', '秒'];
                            bases = [0, 60, 60];
                            maxVals = [12, 59, 59];
                        } else {
                            units = ['時', '分'];
                            bases = [0, 60];
                            maxVals = [23, 59];
                        }
                    }

                    config = {
                        ...config,
                        type: isAdd ? 'add' : 'sub',
                        units: units,
                        bases: bases,
                        maxVals: maxVals,
                        forceCarry: isAdd,
                        forceBorrow: !isAdd
                    };
                }

                const newProb = generateProblem(config);
                setProblem(newProb);
                setUserInputs({});
                setBorrowState({});
                setCarryState({});
                setIsBorrowingMode(false);
                setBorrowTarget(null);
                setWaitingForCarry(null);
                setErrorUnit(null);
                setArrowAnim(null);
                setFloatAnims([]);
                setElementOffsets({}); // Reset all offsets

                const lastIndex = newProb.units.length - 1;
                setCurrentUnitIndex(lastIndex);

                if (newProb.type === 'sub') {
                    const topVal = newProb.top[lastIndex];
                    const bottomVal = newProb.bottom[lastIndex];
                    if (topVal < bottomVal) {
                        setIsBorrowingMode(true);
                        setBorrowTarget(lastIndex - 1);
                        setFeedback({ type: 'info', msg: `咦？ ${topVal} 不夠減 ${bottomVal}，請點擊左邊單位「借位」！` });
                    } else {
                        setFeedback({ type: 'info', msg: `計算：${topVal} - ${bottomVal} 是多少？` });
                    }
                } else {
                    setFeedback({ type: 'info', msg: `請計算最右邊的「${newProb.units[lastIndex]}」總和是多少？` });
                }

            }, []);

            useEffect(() => {
                startLevel(1);
            }, [startLevel]);

            const handleNumPad = (num) => {
                if (!problem || showCertificate || currentUnitIndex === null) return;

                if (waitingForCarry && waitingForCarry.unitIndex === currentUnitIndex) {
                    setFeedback({ type: 'warning', msg: '超過範圍了！請點擊下方的「進位」按鈕或按 Enter。' });
                    triggerShake();
                    return;
                }

                if (isBorrowingMode) {
                    triggerShake();
                    setErrorUnit(currentUnitIndex);
                    setFeedback({ type: 'error', msg: '現在不夠減！請先點擊左邊的數字進行「借位」！' });
                    return;
                }

                const currentVal = userInputs[currentUnitIndex] || '';
                if (currentVal.length >= 3) return;

                const newVal = currentVal + num;

                if (errorUnit === currentUnitIndex) setErrorUnit(null);
                setUserInputs({ ...userInputs, [currentUnitIndex]: newVal });
            };

            const handleCheckInput = () => {
                if (currentUnitIndex === null || !problem) return;

                const currentVal = userInputs[currentUnitIndex] || '';
                const parsedNewVal = parseInt(currentVal);

                if (isNaN(parsedNewVal)) return;

                if (problem.type === 'add') {
                    const topVal = problem.top[currentUnitIndex];
                    const bottomVal = problem.bottom[currentUnitIndex];
                    const carryIn = carryState[currentUnitIndex] || 0;
                    const rawSum = topVal + bottomVal + carryIn;
                    const base = problem.bases[currentUnitIndex];
                    const expectedFinal = problem.expected[currentUnitIndex];

                    const needsCarryStep = base > 0 && rawSum >= base;

                    if (needsCarryStep) {
                        if (parsedNewVal === rawSum) {
                            setFeedback({ type: 'warning', msg: `${rawSum} 滿 ${base} 囉！請點擊「進位」按鈕或按 Enter。` });
                            setWaitingForCarry({ unitIndex: currentUnitIndex, rawSum: rawSum, base: base, final: expectedFinal });
                            return;
                        } else {
                            triggerShake();
                            setErrorUnit(currentUnitIndex);
                            setFeedback({ type: 'error', msg: `請先輸入加總數字 (例如 ${rawSum})，再進行進位喔！` });
                            setUserInputs({ ...userInputs, [currentUnitIndex]: '' });
                            setStreak(0);
                        }
                    } else {
                        if (parsedNewVal === expectedFinal) {
                            handleSuccessStep(currentUnitIndex);
                        } else {
                            triggerShake();
                            setErrorUnit(currentUnitIndex);
                            setFeedback({ type: 'error', msg: '算錯囉，再試一次！' });
                            setUserInputs({ ...userInputs, [currentUnitIndex]: '' });
                            setStreak(0);
                        }
                    }
                }
                else { // Subtraction
                    const expected = problem.expected[currentUnitIndex];
                    if (parsedNewVal === expected) {
                        handleSuccessStep(currentUnitIndex);
                    } else {
                        triggerShake();
                        setErrorUnit(currentUnitIndex);
                        setFeedback({ type: 'error', msg: '算錯囉，再試一次！' });
                        setUserInputs({ ...userInputs, [currentUnitIndex]: '' });
                        setStreak(0);
                    }
                }
            };

            const executeManualCarry = () => {
                if (!waitingForCarry) return;
                const { unitIndex, rawSum, base, final } = waitingForCarry;

                setUserInputs(prev => ({ ...prev, [unitIndex]: final.toString() }));

                const nextIdx = unitIndex - 1;
                setCarryState(prev => ({ ...prev, [nextIdx]: 1 }));

                const newAnims = [
                    { id: Date.now() + 1, idx: unitIndex, text: `-${base}`, type: 'sub' },
                    { id: Date.now() + 2, idx: nextIdx, text: `+1`, type: 'carry' }
                ];
                setFloatAnims(newAnims);

                setWaitingForCarry(null);

                setFeedback({ type: 'success', msg: `進位成功！ ${rawSum} - ${base} = ${final}，進 1 到左邊。` });

                setTimeout(() => {
                    setFloatAnims([]);
                    handleSuccessStep(unitIndex);
                }, 1200);
            };

            const handleSuccessStep = (idx) => {
                setScore(s => s + 10);
                const nextIdx = idx - 1;

                if (nextIdx < 0) {
                    setFeedback({ type: 'success', msg: `太棒了！答對了！目前連勝 ${streak + 1} 題！` });
                    setStreak(s => s + 1);
                    setCurrentUnitIndex(null);
                    setTimeout(() => {
                        if (nextButtonRef.current) nextButtonRef.current.focus();
                    }, 100);
                } else {
                    setCurrentUnitIndex(nextIdx);
                    const unitName = problem.units[nextIdx];
                    if (problem.type === 'sub') {
                        let topVal = getEffectiveValue(nextIdx, problem.top, borrowState);
                        const bottomVal = problem.bottom[nextIdx];
                        if (topVal < bottomVal) {
                            setIsBorrowingMode(true);
                            setBorrowTarget(nextIdx - 1);
                            setFeedback({ type: 'warning', msg: `糟糕，${unitName}剩 ${topVal}，不夠減 ${bottomVal}！請向左邊借位。` });
                        } else {
                            setFeedback({ type: 'success', msg: `答對了！接下來算「${unitName}」。` });
                        }
                    } else {
                        const carryIn = carryState[nextIdx] || 0;
                        if (carryIn > 0) {
                            setFeedback({ type: 'success', msg: `進位成功！記得要加上進來的 ${carryIn} 喔！` });
                        } else {
                            setFeedback({ type: 'success', msg: `答對了！接下來算「${unitName}」。` });
                        }
                    }
                }
            };

            const handleBorrow = (lenderIdx) => {
                if (!isBorrowingMode) return;

                let effectiveVal = getEffectiveValue(lenderIdx, problem.top, borrowState);

                if (effectiveVal > 0) {
                    const borrowerIdx = lenderIdx + 1;
                    const base = problem.bases[borrowerIdx];
                    const newState = { ...borrowState };

                    if (!newState[lenderIdx]) newState[lenderIdx] = {};
                    newState[lenderIdx].borrowedFrom = true;

                    if (!newState[borrowerIdx]) newState[borrowerIdx] = {};
                    newState[borrowerIdx].receivedBorrow = true;
                    newState[borrowerIdx].addedVal = base;

                    setBorrowState(newState);
                    setArrowAnim({ from: lenderIdx, to: borrowerIdx });

                    setFloatAnims([{ id: Date.now(), idx: borrowerIdx, text: `+${base}`, type: 'borrow' }]);
                    setTimeout(() => {
                        setFloatAnims([]);
                        setArrowAnim(null);
                    }, 1000);

                    const currentUnitEffVal = getEffectiveValue(currentUnitIndex, problem.top, newState);
                    const currentUnitBottom = problem.bottom[currentUnitIndex];

                    if (borrowerIdx === currentUnitIndex) {
                        if (currentUnitEffVal >= currentUnitBottom) {
                            setIsBorrowingMode(false);
                            setFeedback({ type: 'success', msg: `借位成功！現在夠減了，請繼續計算。` });
                        } else {
                            setIsBorrowingMode(false);
                        }
                    } else {
                        setFeedback({ type: 'info', msg: `現在「${problem.units[borrowerIdx]}」有 ${getEffectiveValue(borrowerIdx, problem.top, newState)} 了，再向它借給「${problem.units[borrowerIdx + 1]}」吧！` });
                    }
                } else {
                    setErrorUnit(lenderIdx);
                    triggerShake();
                    setFeedback({ type: 'error', msg: `這裡是 0，不能借！請先跟左邊的「${problem.units[lenderIdx - 1]}」借！` });
                }
            };

            const triggerShake = () => {
                setShake(true);
                setTimeout(() => setShake(false), 500);
            };

            const nextLevel = () => {
                const currentConfig = LEVELS.find(l => l.level === level);
                if (streak >= 3 && level < 10) {
                    setLevel(l => l + 1);
                    setStreak(0);
                    startLevel(level + 1);
                } else if (level === 10 && streak >= 3) {
                    setShowCertificate(true);
                } else {
                    startLevel(level);
                }
            };

            const handleBackspace = () => {
                if (currentUnitIndex !== null && userInputs[currentUnitIndex]) {
                    setUserInputs(prev => ({
                        ...prev,
                        [currentUnitIndex]: prev[currentUnitIndex].slice(0, -1)
                    }));
                }
            };

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.key >= '0' && e.key <= '9') {
                        handleNumPad(e.key);
                    }
                    else if (e.key === 'Backspace') {
                        handleBackspace();
                    }
                    else if (e.key === 'Enter') {
                        e.preventDefault();
                        if (currentUnitIndex === null) {
                            nextLevel();
                        } else if (waitingForCarry) {
                            executeManualCarry();
                        } else {
                            handleCheckInput();
                        }
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            });


            return (
                <div className="min-h-screen flex flex-col md:flex-row bg-emerald-50 font-sans">
                    {/* Sidebar */}
                    <div className="w-full md:w-64 bg-white border-r border-emerald-100 p-6 flex flex-col shadow-sm z-10">
                        <h1 className="text-2xl font-bold text-emerald-600 flex items-center gap-2 mb-1">
                            <Clock className="animate-spin-slow" /> 直式時間加減小學堂
                        </h1>
                        <p className="text-xs text-emerald-500 mb-6 font-medium">四年級時間加減法專用</p>
                        <div className="flex-1 overflow-y-auto space-y-2">
                            {LEVELS.map(l => (
                                <button
                                    key={l.level}
                                    onClick={(e) => { e.currentTarget.blur(); setLevel(l.level); setStreak(0); startLevel(l.level); }}
                                    disabled={showCertificate}
                                    className={`w-full text-left p-3 rounded-xl border transition-all ${level === l.level ? 'bg-emerald-100 border-emerald-500 text-emerald-800 ring-1 ring-emerald-500' : 'bg-white border-slate-100 text-slate-500 hover:bg-slate-50'}`}
                                >
                                    <div className="font-bold text-base">Level {l.level}</div>
                                    <div className="text-sm opacity-80">{l.label}: {l.desc}</div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Main Area */}
                    <div className="flex-1 flex flex-col bg-emerald-50/50">

                        {/* Top Score Bar */}
                        <div className="w-full max-w-4xl px-6 pt-6 flex justify-end gap-4 ml-auto">
                            <div className="bg-white px-4 py-2 rounded-xl shadow-sm border border-slate-200 flex items-center gap-2">
                                <Trophy className="text-amber-500 w-5 h-5" />
                                <div>
                                    <div className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">積分</div>
                                    <div className="text-xl font-black text-slate-700 leading-none">{score}</div>
                                </div>
                            </div>
                            <div className="bg-white px-4 py-2 rounded-xl shadow-sm border border-slate-200 flex items-center gap-2">
                                <Flame className={`w-5 h-5 ${streak > 0 ? 'text-orange-500' : 'text-slate-300'}`} />
                                <div>
                                    <div className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">連勝</div>
                                    <div className="text-xl font-black text-slate-700 leading-none">{streak}</div>
                                </div>
                            </div>
                        </div>

                        <div className="flex-1 flex flex-col items-center justify-center relative p-4">
                            {showCertificate ? (
                                <div className="bg-white p-8 rounded-2xl shadow-2xl border-4 border-amber-300 text-center max-w-lg animate-pop-in">
                                    <Trophy className="w-24 h-24 mx-auto text-amber-400 mb-4 drop-shadow-lg" />
                                    <h2 className="text-3xl font-black text-slate-800 mb-2">時間運算大師！</h2>
                                    <p className="text-slate-600 mb-6">你已經精通了時間的進位與借位，連最難的時分秒混合運算都難不倒你！</p>
                                    <div className="text-4xl font-black text-emerald-600 mb-8">{score} 分</div>
                                    <button onClick={() => window.location.reload()} className="bg-emerald-500 text-white px-8 py-3 rounded-full font-bold hover:bg-emerald-600 shadow-lg">重新挑戰</button>
                                </div>
                            ) : (
                                <>
                                    {/* Feedback Bar */}
                                    <div className={`mb-8 px-6 py-3 rounded-full shadow-sm border flex items-center gap-3 transition-colors duration-300 max-w-xl w-full
                                        ${feedback.type === 'error' ? 'bg-red-50 border-red-200 text-red-600' :
                                            feedback.type === 'success' ? 'bg-green-50 border-green-200 text-green-700' :
                                                feedback.type === 'warning' ? 'bg-amber-50 border-amber-200 text-amber-700' :
                                                    'bg-white border-emerald-100 text-emerald-700'}
                                    `}>
                                        {feedback.type === 'error' ? <div className="bg-red-100 p-1 rounded-full"><div className="w-2 h-2 bg-red-500 rounded-full"></div></div> :
                                            feedback.type === 'success' ? <div className="bg-green-100 p-1 rounded-full"><div className="w-2 h-2 bg-green-500 rounded-full"></div></div> :
                                                <div className="bg-emerald-100 p-1 rounded-full"><div className="w-2 h-2 bg-emerald-500 rounded-full"></div></div>}
                                        <span className="font-bold">{feedback.msg}</span>
                                    </div>

                                    {/* Math Card */}
                                    {problem && (
                                        <div className="bg-white rounded-3xl shadow-xl border border-slate-200 relative select-none p-6 md:p-12 overflow-visible">
                                            <div className="inline-flex justify-center items-end relative">
                                                {/* Operator Column */}
                                                <div className="h-20 flex items-center justify-center text-3xl font-bold text-slate-300 mb-[6.5rem] op-width">
                                                    {problem.type === 'sub' ? '-' : '+'}
                                                </div>

                                                {/* Unit Columns */}
                                                {problem.units.map((u, i) => {
                                                    const base = problem.bases[i];
                                                    const isActive = i === currentUnitIndex;
                                                    const isLender = borrowState[i]?.borrowedFrom;
                                                    const isBorrower = borrowState[i]?.receivedBorrow;
                                                    const effectiveVal = getEffectiveValue(i, problem.top, borrowState);
                                                    const canBeClicked = isBorrowingMode && i < currentUnitIndex;
                                                    const hasError = errorUnit === i;
                                                    const carryIn = carryState[i] || 0;
                                                    const isWaitingForThis = waitingForCarry && waitingForCarry.unitIndex === i;

                                                    // Dynamic font size for input
                                                    const inputValue = userInputs[i] || '';
                                                    const inputFontSize = inputValue.length >= 3 ? 'text-3xl' : 'text-4xl';

                                                    // Bubble position logic (Allow drag)
                                                    const bubbleId = `bubble-${i}`;
                                                    const errorId = `error-${i}`;
                                                    const bubbleOffset = elementOffsets[bubbleId] || { x: 0, y: 0 };
                                                    const errorOffset = elementOffsets[errorId] || { x: 0, y: 0 };

                                                    return (
                                                        <div key={i} className="flex">
                                                            <div className="flex flex-col items-center relative col-width">
                                                                {/* Header */}
                                                                <div className="flex flex-col items-center mb-24 h-10 justify-end">
                                                                    {base > 0 && i > 0 && (
                                                                        <div className="text-xs font-bold text-emerald-600 bg-emerald-100 rounded-full px-3 py-1 mb-1 whitespace-nowrap shadow-sm">滿{base}進1</div>
                                                                    )}
                                                                    <div className="text-slate-500 font-bold text-base">{u}</div>
                                                                </div>

                                                                {/* Numbers Area */}
                                                                <div className="flex flex-col gap-3 w-full">
                                                                    <div
                                                                        onClick={() => canBeClicked && handleBorrow(i)}
                                                                        className={`h-20 flex items-center justify-center text-4xl font-mono font-medium rounded-xl transition-all relative group
                                                                        ${canBeClicked ? 'cursor-pointer hover:bg-emerald-50' : ''}
                                                                        ${canBeClicked && effectiveVal > 0 ? 'bg-amber-50 ring-2 ring-amber-200' : ''} 
                                                                        ${isLender ? 'text-slate-300' : 'text-slate-700'}
                                                                    `}>
                                                                        <span className={isLender ? 'strike-through' : ''}>{problem.top[i]}</span>

                                                                        {/* Borrowed From Value - Lifted Higher */}
                                                                        {isLender && <div className="absolute -top-16 text-red-500 font-bold text-3xl animate-pop-in z-30 pointer-events-none">{effectiveVal}</div>}

                                                                        {/* Borrow Bubble - FIX: Nested Structure to separate Drag Transform vs Animation Transform */}
                                                                        {isBorrower && (
                                                                            <div
                                                                                onTouchStart={(e) => startDrag(e, bubbleId)}
                                                                                onMouseDown={(e) => startDrag(e, bubbleId)}
                                                                                className={`absolute -top-20 cursor-move pointer-events-auto touch-none ${activeDragId === bubbleId ? 'z-50' : 'z-30'}`}
                                                                                style={{
                                                                                    transform: `translate(${bubbleOffset.x}px, ${bubbleOffset.y}px)`,
                                                                                    touchAction: 'none'
                                                                                }}
                                                                            >
                                                                                <div className="bg-emerald-100 text-emerald-600 text-sm font-bold px-3 py-1 rounded-full border border-emerald-200 animate-pop-in flex flex-col items-center shadow-sm whitespace-nowrap hover:ring-2 hover:ring-emerald-300 hover:scale-105 transition-transform">
                                                                                    <span>+{base}</span>
                                                                                    <div className="w-px h-3 bg-emerald-300"></div>
                                                                                </div>
                                                                            </div>
                                                                        )}

                                                                        {/* Float Animations (Array) */}
                                                                        {floatAnims.map(anim => anim.idx === i && (
                                                                            <div key={anim.id} className={`absolute -top-12 font-bold text-2xl animate-float-up z-20 pointer-events-none ${anim.type === 'carry' ? 'text-emerald-500' : anim.type === 'sub' ? 'text-red-500' : 'text-emerald-500'}`}>
                                                                                {anim.text}
                                                                            </div>
                                                                        ))}

                                                                        {canBeClicked && effectiveVal === 0 && <div className="absolute inset-0 rounded-xl border-2 border-dashed border-red-300 opacity-50 group-hover:opacity-100 pointer-events-none"></div>}
                                                                    </div>

                                                                    <div className="h-20 flex items-center justify-center text-4xl font-mono font-medium text-slate-700">{problem.bottom[i]}</div>
                                                                    <div className="w-full h-1.5 bg-slate-200 rounded-full my-2 relative">
                                                                        {carryIn > 0 && (
                                                                            <div className="absolute -top-8 left-2 flex flex-col items-center animate-pop-in pointer-events-none">
                                                                                <div className="text-sm font-bold bg-red-100 text-red-600 px-2 py-0.5 rounded-full border border-red-200">+{carryIn}</div>
                                                                                <div className="w-px h-3 bg-red-300"></div>
                                                                            </div>
                                                                        )}
                                                                    </div>

                                                                    {/* Input Box */}
                                                                    <div className="relative w-full">
                                                                        <div className={`
                                                                            w-full h-24 rounded-2xl border-[3px] ${inputFontSize} font-mono font-medium flex items-center justify-center transition-all bg-white
                                                                            ${isActive ? 'border-emerald-400 ring-4 ring-emerald-100 text-emerald-600 shadow-lg scale-105 z-10' : 'border-slate-200 text-slate-300'}
                                                                            ${shake && isActive ? 'animate-shake border-red-400 bg-red-50' : ''}
                                                                            ${isWaitingForThis ? 'border-amber-400 bg-amber-50 ring-4 ring-amber-200 text-amber-700' : ''}
                                                                        `}>
                                                                            {userInputs[i] || ''}
                                                                            {isActive && !userInputs[i] && !isWaitingForThis && <div className="w-1 h-12 bg-emerald-200 animate-pulse rounded-full opacity-50" />}
                                                                        </div>
                                                                        {isWaitingForThis && (
                                                                            <button onClick={executeManualCarry} className="absolute -bottom-16 left-1/2 -translate-x-1/2 bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-full shadow-lg animate-bounce z-40 flex items-center gap-2 whitespace-nowrap">
                                                                                <HandPointer size={16} /> 進位 (減{waitingForCarry.base})
                                                                            </button>
                                                                        )}

                                                                        {/* Error Message Bubble - FIX: Nested Structure */}
                                                                        {hasError && (
                                                                            <div
                                                                                onTouchStart={(e) => startDrag(e, errorId)}
                                                                                onMouseDown={(e) => startDrag(e, errorId)}
                                                                                className={`absolute -top-24 left-1/2 cursor-move pointer-events-auto touch-none ${activeDragId === errorId ? 'z-50' : 'z-30'}`}
                                                                                style={{
                                                                                    transform: `translate(calc(-50% + ${errorOffset.x}px), ${errorOffset.y}px)`,
                                                                                    touchAction: 'none'
                                                                                }}
                                                                            >
                                                                                <div className="animate-pop-in w-40">
                                                                                    <div className="bg-red-50 border border-red-200 text-red-600 text-xs font-bold px-3 py-2 rounded-lg shadow-lg text-center relative hover:ring-2 hover:ring-red-200 transition-shadow">
                                                                                        {isBorrowingMode && problem.top[i] === 0 ? "這裡是0，先跟左邊借！" : (isBorrowingMode ? "不夠減！請向左邊借位" : "算錯囉，再試一次！")}
                                                                                        <div className="bubble-arrow"></div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            {i < problem.units.length - 1 && <div className="gap-width"></div>}
                                                        </div>
                                                    );
                                                })}

                                                {arrowAnim && (
                                                    <svg className="absolute top-0 left-0 w-full h-full pointer-events-none z-20" style={{ overflow: 'visible' }}>
                                                        <defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#10b981" /></marker></defs>
                                                        {(() => {
                                                            const colW = 100, gapW = 24, opW = 32, halfCol = 50;
                                                            const startX = opW + (arrowAnim.from * (colW + gapW)) + halfCol;
                                                            const endX = opW + (arrowAnim.to * (colW + gapW)) + halfCol;
                                                            const startY = 120, endY = 120, controlY = 60;
                                                            return <path d={`M ${startX} ${startY} Q ${(startX + endX) / 2} ${controlY} ${endX} ${endY}`} fill="none" stroke="#10b981" strokeWidth="4" markerEnd="url(#arrowhead)" className="animate-draw-arrow" />;
                                                        })()}
                                                    </svg>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {/* Controls */}
                                    <div className="mt-8 w-full max-w-sm">
                                        {currentUnitIndex === null ? (
                                            <button ref={nextButtonRef} onClick={nextLevel} className="w-full py-4 bg-emerald-500 hover:bg-emerald-600 text-white text-xl font-bold rounded-2xl shadow-lg shadow-emerald-200 transition-transform active:scale-95 flex items-center justify-center gap-2">
                                                <RefreshCw className={streak > 0 ? "animate-spin" : ""} /> 下一題 (Enter)
                                            </button>
                                        ) : (
                                            <div className="grid grid-cols-3 gap-3">
                                                {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(n => <button key={n} onClick={() => handleNumPad(n.toString())} className="h-16 bg-white border-b-4 border-slate-200 rounded-xl text-2xl font-bold text-slate-600 active:border-b-0 active:translate-y-1 transition-all hover:bg-slate-50">{n}</button>)}
                                                <button onClick={handleBackspace} className="h-16 bg-red-50 border-b-4 border-red-100 rounded-xl text-red-400 font-bold active:border-b-0 active:translate-y-1 flex items-center justify-center hover:bg-red-100"><ArrowLeft size={24} /></button>
                                                <button onClick={() => handleNumPad('0')} className="h-16 bg-white border-b-4 border-slate-200 rounded-xl text-2xl font-bold text-slate-600 active:border-b-0 active:translate-y-1 hover:bg-slate-50">0</button>
                                                <button onClick={handleCheckInput} className="h-16 bg-emerald-100 border-b-4 border-emerald-300 rounded-xl text-emerald-600 font-bold active:border-b-0 active:translate-y-1 flex items-center justify-center hover:bg-emerald-200"><ArrowRight size={24} /></button>
                                            </div>
                                        )}
                                    </div>
                                </>
                            )}
                        </div>

                        {/* Learning Cards Footer */}
                        <div className="bg-white border-t border-slate-200 p-6 md:p-8 mt-auto w-full">
                            <div className="max-w-6xl mx-auto">
                                <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                                    <BookOpen className="text-emerald-600" />
                                    時間運算小秘訣
                                </h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

                                    <div className="p-4 rounded-xl bg-slate-50 border border-slate-100 flex gap-3">
                                        <div className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold shrink-0">1</div>
                                        <div>
                                            <h4 className="font-bold text-slate-800 mb-1 text-lg">60進位 (分/秒)</h4>
                                            <p className="text-base text-slate-600">秒和分都是滿 60 進 1。如果加起來超過 60，記得減掉 60，然後進位給左邊喔！</p>
                                        </div>
                                    </div>

                                    <div className="p-4 rounded-xl bg-slate-50 border border-slate-100 flex gap-3">
                                        <div className="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center font-bold shrink-0">2</div>
                                        <div>
                                            <h4 className="font-bold text-slate-800 mb-1 text-lg">借位技巧</h4>
                                            <p className="text-base text-slate-600">減法不夠減時，向左邊借 1。借來的 1 分鐘變成 60 秒，加上原本的秒數就不怕不夠減了。</p>
                                        </div>
                                    </div>

                                    <div className="p-4 rounded-xl bg-slate-50 border border-slate-100 flex gap-3">
                                        <div className="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold shrink-0">3</div>
                                        <div>
                                            <h4 className="font-bold text-slate-800 mb-1 text-lg">24進位 (日/時)</h4>
                                            <p className="text-base text-slate-600">日和時不一樣喔！1 日等於 24 小時。所以時滿 24 要進位到日，日借位給時是換成 24。</p>
                                        </div>
                                    </div>

                                    <div className="p-4 rounded-xl bg-slate-50 border border-slate-100 flex gap-3">
                                        <div className="w-10 h-10 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold shrink-0">
                                            <Keyboard size="20" />
                                        </div>
                                        <div>
                                            <h4 className="font-bold text-slate-800 mb-1 text-lg">操作說明</h4>
                                            <p className="text-base text-slate-600">從最右邊開始算。輸入數字後按「Enter」或箭頭檢查。遇到進位按鈕記得按下去喔！</p>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TimeMathApp />);
    </script>
</body>

</html>